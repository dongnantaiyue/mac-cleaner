name: Build Windows EXE

# 触发条件：当你向 main 分支推送代码，或者手动点击运行时触发
on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    name: Build EXE on Windows
    # 关键点：指定这台云端电脑的系统是 Windows
    runs-on: windows-latest

    steps:
    # 1. 把它拉取你的代码到云端电脑上
    - name: Checkout Code
      uses: actions/checkout@v4

    # 2. 在云端电脑上安装 Python 3.10
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    # 3. 安装依赖库 (PyInstaller)
    - name: Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pyinstaller
        # 如果你的程序用到了其他库（比如 pandas），请在这里加一行 pip install pandas

    # 4. 开始打包 (这是最核心的一步)
    - name: Build with PyInstaller
      run: |
        # 请确保下面的 clean_win.py 和你仓库里的真实文件名完全一致！
        # --onefile 表示打包成单文件
        # --windowed 表示运行时不显示黑框
        pyinstaller --name "WindowsCleaner" --onefile --windowed clean_win.py

    # 5. 把打包好的 .exe 文件上传，供你下载
    - name: Upload EXE Artifact
      uses: actions/upload-artifact@v4
      with:
        name: Windows-Cleaner-App  # 这是你下载到的压缩包的名字
        path: dist/*.exe          # 只上传 dist 文件夹里的 exe 文件
